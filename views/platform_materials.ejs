<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Materials - Study Flow</title>
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        .materials-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .material-card {
            background: var(--background-card);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: 0 2px 8px var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .material-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .material-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .material-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .material-icon .material-icons-outlined {
            font-size: 1.8rem;
        }

        .material-info {
            flex-grow: 1;
        }

        .material-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin: 0 0 0.3rem 0;
            color: var(--text-dark);
        }

        .material-meta {
            font-size: 0.85rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .material-type-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-note {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-link {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .badge-document {
            background: #fff3e0;
            color: #f57c00;
        }

        .material-content {
            margin: 1rem 0;
            color: var(--text-medium);
            line-height: 1.6;
        }

        .material-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .material-actions .button {
            flex: 1;
            padding: 0.6rem;
            font-size: 0.9rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }

        .empty-state .material-icons-outlined {
            font-size: 5rem;
            opacity: 0.3;
            margin-bottom: 1rem;
        }

        .filter-section {
            background: var(--background-card);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px var(--shadow-light);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-section select {
            padding: 0.6rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--background-card);
            color: var(--text-dark);
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="dashboard-wrapper">
        <%- include('partials/sidebar', { currentPage: 'platform-materials', username: username }) %>
        <main class="main-content">
            <h1>
                <span class="material-icons-outlined" style="font-size: 2.5rem; vertical-align: middle; margin-right: 10px;">library_books</span>
                Platform Materials
            </h1>

            <div class="materials-container">
                <div class="card">
                    <h3>Study Resources & Materials</h3>
                    <p>Access learning materials, study guides, and resources shared by administrators and teachers.</p>
                </div>

                <div class="filter-section">
                    <label for="type-filter" style="font-weight: 600; color: var(--text-dark);">Filter by Type:</label>
                    <select id="type-filter" onchange="filterMaterials()">
                        <option value="all">All Types</option>
                        <option value="note">Notes</option>
                        <option value="link">Links/Videos</option>
                        <option value="document">Documents</option>
                    </select>
                </div>

                <% if (materials && materials.length > 0) { %>
                    <div class="materials-grid">
                        <% materials.forEach(material => { %>
                            <div class="material-card" data-type="<%= material.type %>">
                                <div class="material-header">
                                    <div class="material-icon">
                                        <span class="material-icons-outlined">
                                            <%= material.type === 'note' ? 'description' : material.type === 'link' ? 'link' : 'folder' %>
                                        </span>
                                    </div>
                                    <div class="material-info">
                                        <h4 class="material-title"><%= material.title %></h4>
                                        <div class="material-meta">
                                            <span class="material-type-badge badge-<%= material.type %>">
                                                <%= material.type %>
                                            </span>
                                            <span>â€¢</span>
                                            <span>By <%= material.admin_name || 'Admin' %></span>
                                        </div>
                                        <div class="material-meta" style="margin-top: 0.3rem;">
                                            <span class="material-icons-outlined" style="font-size: 1rem;">calendar_today</span>
                                            <%= new Date(material.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                        </div>
                                    </div>
                                </div>

                                <% if (material.content) { %>
                                    <div class="material-content">
                                        <%= material.content.substring(0, 150) %><%= material.content.length > 150 ? '...' : '' %>
                                    </div>
                                <% } %>

                                <!-- Update the material-actions section in platform_materials.ejs -->
                            <!-- Replace the existing material-actions div with this updated version -->

                            <div class="material-actions">
                                <% if (material.file_path) { %>
                                    <a href="/download-material/<%= material.id %>" class="button primary-btn" style="text-decoration: none;">
                                        <span class="material-icons-outlined" style="font-size: 1rem;">download</span>
                                        Download
                                    </a>
                                <% } %>
                                <% if (material.link_url) { %>
                                    <a href="<%= material.link_url %>" target="_blank" class="button primary-btn" style="text-decoration: none;">
                                        <span class="material-icons-outlined" style="font-size: 1rem;">open_in_new</span>
                                        Open Link
                                    </a>
                                <% } %>
                                <% if (!material.file_path && !material.link_url && material.content) { %>
                                    <button class="button secondary-btn" onclick="showFullContent(this)" 
                                            data-content="<%= encodeURIComponent(material.content || '') %>">
                                        <span class="material-icons-outlined" style="font-size: 1rem;">visibility</span>
                                        View Full
                                    </button>
                                <% } %>
                            </div>

                            <!-- Also update the material-icon section to show file type badge -->
                            

                            <!-- Add this script at the bottom of platform_materials.ejs -->
                            <script>
                                function showFullContent(btn) {
                                    const content = decodeURIComponent(btn.dataset.content);
                                    // Create a modal to show full content
                                    const modal = document.createElement('div');
                                    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;';
                                    modal.innerHTML = `
                                        <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; max-height: 80vh; overflow-y: auto; margin: 1rem;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                                <h3 style="margin: 0;">Full Content</h3>
                                                <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; cursor: pointer; font-size: 1.5rem;">&times;</button>
                                            </div>
                                            <div style="white-space: pre-wrap; line-height: 1.6;">${content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                                        </div>
                                    `;
                                    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
                                    document.body.appendChild(modal);
                                }
                            </script>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <span class="material-icons-outlined">folder_open</span>
                        <h3>No Materials Available Yet</h3>
                        <p>Check back later for study materials and resources from your instructors.</p>
                    </div>
                <% } %>
            </div>
        </main>
    </div>

    <%- include('partials/footer') %>

    <script>
        function filterMaterials() {
            const filterValue = document.getElementById('type-filter').value;
            const cards = document.querySelectorAll('.material-card');
            
            cards.forEach(card => {
                if (filterValue === 'all' || card.dataset.type === filterValue) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>
    <script src="/script.js"></script>
</body>
</html>